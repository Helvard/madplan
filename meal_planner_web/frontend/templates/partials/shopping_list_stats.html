<!-- Shopping list progress and stats - Works with both stats variable and items -->
{% if stats is defined and stats.total_items > 0 %}
    {# Use stats if provided #}
    {% set total_items = stats.total_items %}
    {% set checked_items = stats.checked_items %}
    {% set unchecked_items = stats.unchecked_items %}
    {% set total_cost = stats.total_estimate|default(0) %}
{% elif items and items|length > 0 %}
    {# Calculate from items if stats not provided #}
    {% set total_items = items|length %}
    {% set checked_items = items|selectattr('checked')|list|length %}
    {% set unchecked_items = total_items - checked_items %}
    {% set total_cost = items|rejectattr('checked')|selectattr('price_estimate')|map(attribute='price_estimate')|sum %}
{% else %}
    {% set total_items = 0 %}
    {% set checked_items = 0 %}
    {% set unchecked_items = 0 %}
    {% set total_cost = 0 %}
{% endif %}

{% if total_items > 0 %}
    {% set progress = ((checked_items / total_items * 100)|round|int) %}
    
    <div class="bg-white rounded-lg shadow p-4">
        <div class="flex items-center justify-between mb-3">
            <div>
                <span class="text-2xl font-bold text-gray-900">{{ checked_items }}/{{ total_items }}</span>
                <span class="text-gray-600 ml-2">items checked</span>
            </div>
            {% if total_cost > 0 %}
            <div class="text-right">
                <div class="text-sm text-gray-600">Estimated Total</div>
                <div class="text-xl font-semibold text-green-600">{{ "%.2f"|format(total_cost) }} kr</div>
            </div>
            {% endif %}
        </div>
        
        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
            <div 
                class="bg-gradient-to-r from-green-500 to-green-600 h-4 rounded-full transition-all duration-500 flex items-center justify-center"
                style="width: {{ progress }}%"
            >
                {% if progress > 10 %}
                <span class="text-xs font-semibold text-white">{{ progress }}%</span>
                {% endif %}
            </div>
        </div>
        
        {% if unchecked_items > 0 %}
        <p class="text-xs text-gray-600 text-center mt-1">
            {{ unchecked_items }} item{{ 's' if unchecked_items != 1 else '' }} remaining
        </p>
        {% elif total_items > 0 %}
        <div class="mt-3 text-sm text-green-600 font-medium text-center">
            âœ… All items checked! Ready to clear the list?
        </div>
        {% endif %}
    </div>
{% else %}
    <div class="bg-white rounded-lg shadow p-4">
        <div class="text-gray-500 text-center">
            No items in shopping list yet
        </div>
    </div>
{% endif %}